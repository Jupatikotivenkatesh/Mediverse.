<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Billing | MediSync</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        /* Custom QR Code Border */
        .qr-code {
            max-width: 200px;
            padding: 10px;
            border: 4px solid #dee2e6;
            border-radius: 12px;
        }
    </style>
</head>
<body>

    <div class="container py-5" style="max-width: 900px;">
        
        <div class="card shadow-sm border-0 mb-4 rounded-4">
            <div class="card-body text-center p-4">
                <h1 class="display-6 fw-bold text-primary">Patient Billing Center</h1>
                <p class="text-secondary lead mb-0">View and manage all your hospital bills in one place.</p>
            </div>
        </div>

        <div class="d-flex justify-content-center gap-3 mb-4">
            <button id="filter-pending" class="btn btn-primary rounded-pill px-4">Pending Bills</button>
            <button id="filter-paid" class="btn btn-outline-secondary rounded-pill px-4">Payment History</button>
        </div>

        <div id="bill-list" class="d-flex flex-column gap-3">
            </div>

    </div>

    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 border-0 shadow-lg">
                <div class="modal-header border-bottom-0 pb-0">
                    <h5 class="modal-title fw-bold fs-4" id="paymentModalLabel">Complete Payment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center pt-2 pb-4">
                    
                    <div id="modal-bill-details" class="mb-4 bg-light p-3 rounded-3 text-start"></div>

                    <p class="text-muted mb-2">Scan with any UPI app</p>
                    <img id="upi-qr-code" src="" alt="UPI QR Code" class="qr-code img-fluid mb-3">
                    
                    <p class="mb-1 text-muted">or pay to UPI ID:</p>
                    <div class="bg-light d-inline-block px-3 py-2 rounded mb-4 fw-bold text-primary border" id="upi-id-text"></div>
                    
                    <div class="d-grid gap-2">
                        <a id="upi-payment-link" href="#" class="btn btn-primary fw-bold py-2" target="_blank">
                            <i class="fas fa-mobile-alt me-2"></i> Open UPI App
                        </a>
                    </div>
                    
                    <p class="text-muted small mt-3 mb-0">This is a simulation. No real payment will be processed.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- MOCK DATA ---
            const bills = [
                { id: 'B2025-091', patient: 'Venkatesh P.', amount: 4500.00, dueDate: '2025-09-20', details: 'Consultation & Lab Tests', status: 'Pending'},
                { id: 'B2025-085', patient: 'Priya Sharma', amount: 32000.00, dueDate: '2025-09-18', details: 'Surgical Procedure', status: 'Pending'},
                { id: 'B2025-079', patient: 'Amit Kumar', amount: 8200.00, dueDate: '2025-08-10', details: 'Emergency Services', status: 'Paid'},
                { id: 'B2025-078', patient: 'Venkatesh P.', amount: 12500.00, dueDate: '2025-09-05', details: 'Room Rent & Medication', status: 'Paid'},
                { id: 'B2025-077', patient: 'Sunita Reddy', amount: 650.00, dueDate: '2025-09-12', details: 'Pharmacy Bill', status: 'Pending'}
            ];

            // --- ELEMENT REFERENCES ---
            const billListContainer = document.getElementById('bill-list');
            const filterPendingBtn = document.getElementById('filter-pending');
            const filterPaidBtn = document.getElementById('filter-paid');
            
            // Bootstrap Modal Instance
            const paymentModalElement = document.getElementById('paymentModal');
            const paymentModal = new bootstrap.Modal(paymentModalElement);
            
            const modalBillDetails = document.getElementById('modal-bill-details');
            const upiQrCode = document.getElementById('upi-qr-code');
            const upiIdText = document.getElementById('upi-id-text');
            const upiPaymentLink = document.getElementById('upi-payment-link');

            // --- STATE ---
            let currentFilter = 'Pending';

            // --- FUNCTIONS ---

            const renderBills = () => {
                billListContainer.innerHTML = ''; 

                const filteredBills = bills.filter(bill => bill.status === currentFilter);

                if (filteredBills.length === 0) {
                    billListContainer.innerHTML = `
                        <div class="alert alert-light text-center text-muted border-0 shadow-sm" role="alert">
                            <i class="fas fa-file-invoice fa-2x mb-2 d-block text-secondary"></i>
                            No ${currentFilter.toLowerCase()} bills found.
                        </div>`;
                    return;
                }

                filteredBills.forEach(bill => {
                    const billCard = document.createElement('div');
                    billCard.className = 'card border-0 shadow-sm rounded-3 hover-shadow transition';
                    // Custom style for hover effect
                    billCard.style.transition = 'transform 0.2s ease, box-shadow 0.2s ease';
                    billCard.onmouseover = () => { billCard.classList.add('shadow'); billCard.style.transform = 'translateY(-2px)'; };
                    billCard.onmouseout = () => { billCard.classList.remove('shadow'); billCard.style.transform = 'translateY(0)'; };

                    const statusBadge = bill.status === 'Paid' 
                        ? '<span class="badge bg-success-subtle text-success rounded-pill px-3">Paid</span>' 
                        : '<span class="badge bg-warning-subtle text-warning-emphasis rounded-pill px-3">Pending</span>';
                    
                    const amountColor = bill.status === 'Paid' ? 'text-success' : 'text-danger';
                    
                    const payButtonHTML = bill.status === 'Pending' 
                        ? `<button class="btn btn-sm btn-success pay-now-btn fw-bold px-3" data-bill-id="${bill.id}">Pay Now</button>`
                        : '';

                    billCard.innerHTML = `
                        <div class="card-body p-4">
                            <div class="row align-items-center g-3">
                                <div class="col-md-7">
                                    <h5 class="card-title fw-bold mb-1">Bill #${bill.id}</h5>
                                    <p class="text-secondary small mb-1"><i class="fas fa-user me-1"></i> ${bill.patient}</p>
                                    <p class="text-secondary small mb-1"><i class="fas fa-notes-medical me-1"></i> ${bill.details}</p>
                                    <p class="text-secondary small mb-0"><i class="fas fa-calendar-alt me-1"></i> Due: ${bill.dueDate}</p>
                                </div>
                                <div class="col-md-5 text-md-end">
                                    <div class="d-flex flex-column align-items-md-end align-items-start gap-2">
                                        <h3 class="${amountColor} fw-bold mb-0">₹${bill.amount.toFixed(2)}</h3>
                                        <div class="d-flex align-items-center gap-2">
                                            ${statusBadge}
                                            ${payButtonHTML}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    billListContainer.appendChild(billCard);
                });
            };

            const openPaymentModal = (billId) => {
                const bill = bills.find(b => b.id === billId);
                if (!bill) return;
                
                // UPI Details
                const hospitalName = "PharmaCare Hospital";
                const upiId = "pharma.care@okhdfcbank"; 
                const transactionNote = `Payment for Bill ${bill.id}`;
                
                modalBillDetails.innerHTML = `
                    <div class="d-flex justify-content-between mb-1">
                        <span class="text-secondary">Bill ID:</span>
                        <span class="fw-bold text-dark">${bill.id}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-1">
                        <span class="text-secondary">Patient:</span>
                        <span class="fw-bold text-dark">${bill.patient}</span>
                    </div>
                    <div class="border-top my-2"></div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-secondary">Total Amount:</span>
                        <span class="fs-4 fw-bold text-primary">₹${bill.amount.toFixed(2)}</span>
                    </div>
                `;

                // Generate UPI Link
                const upiUrl = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(hospitalName)}&am=${bill.amount.toFixed(2)}&cu=INR&tn=${encodeURIComponent(transactionNote)}`;
                const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(upiUrl)}`;

                upiQrCode.src = qrCodeUrl;
                upiIdText.textContent = upiId;
                upiPaymentLink.href = upiUrl;
                
                paymentModal.show();
            };

            // --- EVENT LISTENERS ---

            filterPendingBtn.addEventListener('click', () => {
                currentFilter = 'Pending';
                filterPendingBtn.classList.replace('btn-outline-secondary', 'btn-primary');
                filterPaidBtn.classList.replace('btn-primary', 'btn-outline-secondary');
                renderBills();
            });

            filterPaidBtn.addEventListener('click', () => {
                currentFilter = 'Paid';
                filterPaidBtn.classList.replace('btn-outline-secondary', 'btn-primary');
                filterPendingBtn.classList.replace('btn-primary', 'btn-outline-secondary');
                renderBills();
            });

            billListContainer.addEventListener('click', (event) => {
                if (event.target.classList.contains('pay-now-btn')) {
                    const billId = event.target.dataset.billId;
                    openPaymentModal(billId);
                }
            });

            // Initial Render
            renderBills();
        });
    </script>
</body>
</html>