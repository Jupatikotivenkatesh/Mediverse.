<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediScan - Medicine Identifier</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* A light blue-gray background */
        }

        .action-button {
            border: 2px dashed #a5b4fc;
            background-color: #eef2ff;
            color: #4338ca;
            transition: all 0.3s ease;
        }
        .action-button:hover {
            border-style: solid;
            background-color: #e0e7ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        #results-container .detail-item {
            border-bottom: 1px solid #e5e7eb;
        }
        #results-container .detail-item:last-child {
            border-bottom: none;
        }

        /* Spinner Animation */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div id="app" class="max-w-2xl mx-auto min-h-screen bg-white shadow-lg my-0 sm:my-8 rounded-lg overflow-hidden">
        
        <!-- Header -->
        <header class="bg-indigo-600 text-white p-5 text-center shadow-md">
            <div class="flex items-center justify-center">
                <i class="fas fa-camera-retro text-3xl mr-3"></i>
                <h1 class="text-2xl font-bold">MediScan</h1>
            </div>
            <p class="text-indigo-200 text-sm mt-1">Get instant medicine information from a photo</p>
        </header>

        <!-- Main Content -->
        <main class="p-4 sm:p-6 md:p-8">

            <!-- Initial State: Upload/Capture Options -->
            <div id="initial-state">
                <div class="text-center mb-6">
                    <h2 class="text-xl font-semibold text-gray-700">Scan Your Medicine</h2>
                    <p class="text-gray-500 mt-1">Upload or take a picture of the medicine strip or box.</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- File Upload Button -->
                    <label for="image-upload-input" class="action-button w-full p-8 rounded-lg cursor-pointer text-center">
                        <i class="fas fa-upload text-4xl mb-3"></i>
                        <span class="block font-semibold">Upload Image</span>
                    </label>
                    <input type="file" id="image-upload-input" class="hidden" accept="image/*">
                    
                    <!-- Camera Button -->
                    <button id="open-camera-btn" class="action-button w-full p-8 rounded-lg text-center">
                        <i class="fas fa-camera text-4xl mb-3"></i>
                        <span class="block font-semibold">Use Camera</span>
                    </button>
                </div>
            </div>

            <!-- Analysis State: Preview & Results -->
            <div id="analysis-state" class="hidden">
                
                <!-- Image Preview -->
                <div id="image-preview-container" class="mb-6 text-center">
                     <p class="font-semibold text-gray-600 mb-2">Your Image:</p>
                     <img id="image-preview" src="" alt="Medicine Preview" class="max-h-60 mx-auto rounded-lg shadow-md border-4 border-white">
                </div>

                <!-- Results Section -->
                <div class="bg-gray-50 p-5 rounded-lg border">
                    <!-- Loading State -->
                    <div id="loading-state" class="text-center text-gray-500 py-8">
                        <i class="fas fa-spinner fa-spin text-4xl text-indigo-500 spinner"></i>
                        <p class="mt-3 font-semibold">Analyzing Image...</p>
                        <p class="text-sm">Please wait a moment.</p>
                    </div>

                    <!-- Results Display -->
                    <div id="results-container" class="hidden">
                        <h3 class="text-2xl font-bold text-center mb-4 text-indigo-700" id="med-name"></h3>
                        <div class="space-y-4">
                            <div class="detail-item pb-3">
                                <label class="font-semibold text-gray-500 text-sm">Active Ingredients</label>
                                <p id="med-ingredients" class="text-gray-800"></p>
                            </div>
                             <div class="detail-item pb-3">
                                <label class="font-semibold text-gray-500 text-sm">Common Uses</label>
                                <p id="med-uses" class="text-gray-800"></p>
                            </div>
                             <div class="detail-item pb-3">
                                <label class="font-semibold text-gray-500 text-sm">Dosage Information</label>
                                <p id="med-dosage" class="text-gray-800"></p>
                            </div>
                             <div class="detail-item pb-3">
                                <label class="font-semibold text-gray-500 text-sm">Potential Side Effects</label>
                                <p id="med-side-effects" class="text-gray-800"></p>
                            </div>
                            <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 rounded-r-lg">
                                <h4 class="font-bold"><i class="fas fa-exclamation-triangle mr-2"></i>Warnings & Precautions</h4>
                                <p id="med-warnings" class="mt-1 text-sm"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6 text-center">
                     <button id="reset-btn" class="bg-indigo-600 text-white font-bold py-3 px-6 rounded-md hover:bg-indigo-700 transition shadow-lg">
                        <i class="fas fa-redo-alt mr-2"></i>Scan Another Medicine
                    </button>
                </div>

            </div>
        </main>
    </div>

    <!-- Camera View Modal -->
    <div id="camera-view" class="hidden fixed inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center p-4 z-[100]">
        <video id="camera-stream" class="w-full max-w-lg h-auto rounded-lg" autoplay playsinline></video>
        <canvas id="capture-canvas" class="hidden"></canvas>
        <div class="mt-6 flex items-center space-x-4">
            <button type="button" id="close-camera-btn" class="text-white text-lg bg-gray-700 rounded-full w-12 h-12 flex items-center justify-center">&times;</button>
            <button type="button" id="capture-btn" class="w-20 h-20 bg-white rounded-full border-4 border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 ring-offset-2 ring-offset-black"></button>
            <div class="w-12 h-12"></div> <!-- Spacer -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Mock Medicine Database ---
            // In a real app, this would come from an API after image analysis.
            const mockMedicineData = [
                {
                    name: 'Rosuvastatin 10mg',
                    ingredients: 'Rosuvastatin Calcium',
                    uses: 'Lowering high cholesterol and triglycerides, preventing cardiovascular disease.',
                    dosage: 'As prescribed by the doctor. Typically one tablet daily.',
                    sideEffects: 'Headache, muscle pain, nausea, stomach pain, weakness.',
                    warnings: 'Do not take if you are pregnant, have liver disease, or are allergic to the medication. Consult your doctor about all other medications you are taking.'
                },
                {
                    name: 'Metformin 500mg',
                    ingredients: 'Metformin Hydrochloride',
                    uses: 'To control high blood sugar in people with type 2 diabetes.',
                    dosage: 'Usually taken with meals, one or two times a day. Follow your doctor\'s instructions.',
                    sideEffects: 'Nausea, vomiting, stomach upset, diarrhea, weakness.',
                    warnings: 'Avoid drinking alcohol. Stop taking this medication and call your doctor right away if you have symptoms of lactic acidosis, such as unusual muscle pain, trouble breathing, or feeling very weak.'
                },
                {
                    name: 'Amlodipine 5mg',
                    ingredients: 'Amlodipine Besylate',
                    uses: 'To treat high blood pressure (hypertension) and chest pain (angina).',
                    dosage: 'Typically taken once daily. Your doctor may adjust the dose as needed.',
                    sideEffects: 'Swelling of legs or ankles, dizziness, flushing, headache.',
                    warnings: 'Inform your doctor if you have a history of heart or liver problems. Rise slowly from a sitting or lying position to prevent dizziness.'
                },
                {
                    name: 'Paracetamol 500mg',
                    ingredients: 'Paracetamol (Acetaminophen)',
                    uses: 'To relieve mild to moderate pain (headaches, muscle aches, etc.) and to reduce fever.',
                    dosage: '1 to 2 tablets every 4-6 hours as needed. Do not exceed 8 tablets in 24 hours.',
                    sideEffects: 'Rare when taken at recommended doses. Allergic reactions like skin rash can occur.',
                    warnings: 'Overdose can cause severe liver damage. Avoid taking with other products containing paracetamol.'
                },
                {
                    name: 'Amoxicillin 250mg',
                    ingredients: 'Amoxicillin Trihydrate',
                    uses: 'A prescription antibiotic for treating bacterial infections like chest infections, dental abscesses, and UTIs.',
                    dosage: 'Strictly as prescribed by a doctor. Complete the full course of treatment.',
                    sideEffects: 'Nausea, diarrhea, skin rash. Seek immediate medical help for severe allergic reactions.',
                    warnings: 'Only for bacterial infections. Do not use if you have a penicillin allergy. This is a prescription-only medicine.'
                },
                {
                    name: 'Pantoprazole 40mg',
                    ingredients: 'Pantoprazole Sodium',
                    uses: 'To treat acid reflux, heartburn, and stomach ulcers by reducing stomach acid.',
                    dosage: 'Typically one tablet per day, usually taken in the morning. Follow medical advice.',
                    sideEffects: 'Headache, diarrhea, stomach pain, nausea, and flatulence.',
                    warnings: 'Consult a doctor for long-term use or if symptoms do not improve. May interact with other medications.'
                }
            ];

            // --- Element References ---
            const initialState = document.getElementById('initial-state');
            const analysisState = document.getElementById('analysis-state');
            const fileInput = document.getElementById('image-upload-input');
            const openCameraButton = document.getElementById('open-camera-btn');
            const imagePreview = document.getElementById('image-preview');
            const loadingState = document.getElementById('loading-state');
            const resultsContainer = document.getElementById('results-container');
            const resetBtn = document.getElementById('reset-btn');

            // Camera elements
            const cameraView = document.getElementById('camera-view');
            const cameraStreamEl = document.getElementById('camera-stream');
            const captureButton = document.getElementById('capture-btn');
            const closeCameraButton = document.getElementById('close-camera-btn');
            const captureCanvas = document.getElementById('capture-canvas');

            // --- State Management ---
            function showAnalysisState(imageSrc) {
                initialState.classList.add('hidden');
                analysisState.classList.remove('hidden');
                loadingState.classList.remove('hidden');
                resultsContainer.classList.add('hidden');
                imagePreview.src = imageSrc;
                simulateAnalysis();
            }

            function resetToInitialState() {
                analysisState.classList.add('hidden');
                initialState.classList.remove('hidden');
                fileInput.value = ''; // Clear file input
            }

            // --- Main Logic ---
            function simulateAnalysis() {
                setTimeout(() => {
                    // Pick a random medicine from the mock database
                    const medicine = mockMedicineData[Math.floor(Math.random() * mockMedicineData.length)];
                    displayResults(medicine);
                }, 2500); // Simulate a 2.5-second network/analysis delay
            }

            function displayResults(data) {
                document.getElementById('med-name').textContent = data.name;
                document.getElementById('med-ingredients').textContent = data.ingredients;
                document.getElementById('med-uses').textContent = data.uses;
                document.getElementById('med-dosage').textContent = data.dosage;
                document.getElementById('med-side-effects').textContent = data.sideEffects;
                document.getElementById('med-warnings').textContent = data.warnings;

                loadingState.classList.add('hidden');
                resultsContainer.classList.remove('hidden');
            }

            // --- Event Listeners ---
            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        showAnalysisState(e.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            resetBtn.addEventListener('click', resetToInitialState);

            // --- Camera Functionality ---
            async function startCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                    cameraStreamEl.srcObject = stream;
                    cameraView.classList.remove('hidden');
                } catch (err) {
                    console.error("Camera Error:", err);
                    alert('Could not access the camera. Please check permissions and try again.');
                }
            }

            function stopCamera() {
                const stream = cameraStreamEl.srcObject;
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                cameraView.classList.add('hidden');
            }

            function captureImage() {
                const context = captureCanvas.getContext('2d');
                captureCanvas.width = cameraStreamEl.videoWidth;
                captureCanvas.height = cameraStreamEl.videoHeight;
                context.drawImage(cameraStreamEl, 0, 0, captureCanvas.width, captureCanvas.height);
                
                const imageDataUrl = captureCanvas.toDataURL('image/jpeg');
                showAnalysisState(imageDataUrl);
                stopCamera();
            }

            openCameraButton.addEventListener('click', startCamera);
            closeCameraButton.addEventListener('click', stopCamera);
            captureButton.addEventListener('click', captureImage);
        });
    </script>
</body>
</html>

